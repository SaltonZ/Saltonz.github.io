<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="My Blog to document some of my notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Salton&#39;s">
<meta property="og:url" content="https://saltonz.github.io/index.html">
<meta property="og:site_name" content="Salton&#39;s">
<meta property="og:description" content="My Blog to document some of my notes">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Salton&#39;s">
<meta name="twitter:description" content="My Blog to document some of my notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://saltonz.github.io/"/>





  <title>Salton's</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Salton's</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saltonz.github.io/2019/10/19/Search Engine/Inverted Index_1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Salton Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Salton's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/19/Search Engine/Inverted Index_1/" itemprop="url">Inverted Index - C++ based</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-19T00:00:00-04:00">
                2019-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Information-Retrivement/" itemprop="url" rel="index">
                    <span itemprop="name">Information Retrivement</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1><span id="inverted-index-c-based">Inverted Index - C++ based</span></h1><figure class="highlight plain"><figcaption><span>Zhao```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[TOC]</span><br><span class="line"></span><br><span class="line">## Brief Introduction to the program</span><br><span class="line"></span><br><span class="line">This C++ program is used to generate a inverted index for Web Search Engine from the crawled data of web crawler. </span><br><span class="line"></span><br><span class="line">The function of inverted index is:  for each query term, give back the document ID contains this term and the frequency this term showed up in the document.</span><br><span class="line"></span><br><span class="line">&gt; Only support English for now, seeking to support more languages such as Chinese in the future. </span><br><span class="line"></span><br><span class="line">### Input</span><br><span class="line"></span><br><span class="line">The data-set I used is from **Common Crawl**, an data set contains PBs of data crawled from the Internet.</span><br><span class="line"></span><br><span class="line">&gt; https://commoncrawl.org/the-data/</span><br><span class="line"></span><br><span class="line">My program use the WET file format of Common Crawl dataset, because it is some how parsed and we don&apos;t need to care much about web page parsing. </span><br><span class="line"></span><br><span class="line">&lt;!---more---&gt;</span><br><span class="line"></span><br><span class="line">### Output</span><br><span class="line"></span><br><span class="line">There are three outputs of this program.</span><br><span class="line"></span><br><span class="line">1. Inverted_Index</span><br><span class="line"></span><br><span class="line">   This output is main Inverted Index itself, which is saved to disk as binary file in the format as **inverted_index_&#123; part number &#125;.dat**. Which can be directly loaded to memory into an vector according to the memory offset.  With the parameters in the code, typically each part of inverted index is about 120 MB.</span><br><span class="line"></span><br><span class="line">2. Lexicon_map</span><br><span class="line"></span><br><span class="line">   This output is used to store the data for build a Hash Map before the Web Search Engine start working. </span><br><span class="line"></span><br><span class="line">   Lexicon_map is a .txt file, for each line of lexicon map, the structure is:</span><br></pre></td></tr></table></figure>
<p>   [term] [inverted_index offset] [term_start_index] [term_end_index] [total number of doc contains this term]<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   * **term**: A term is basically what we defined as an object we would like to find in documents. Such as word in this implementation.</span><br><span class="line">   * **inverted_index offset**: Since the overall inverted index in build up with several parts of binary file. This parameter tells the term is located is which specific file.</span><br><span class="line">   * **term_start_index**:  The first offset of the term&apos;s information in the inverted index.</span><br><span class="line">   * **term_end_index**: The last offset of the term&apos;s information.</span><br><span class="line">   * **total_number**: The total number of documents that contains this term.</span><br><span class="line"></span><br><span class="line">3. Url_Document_map</span><br><span class="line"></span><br><span class="line">   This output is used to map the url with the document. During the bootstrap of Web Search Engine, this file would be loaded into the memory to construct a hash map from document to url. For each line, the structure is:</span><br></pre></td></tr></table></figure></p>
<p>   [url] [documentID]<br>   <code>`</code></p>
<h3><span id="running-environment">Running Environment</span></h3><p>Tested on <strong>Visual Studio 2017</strong>, <strong>windows 10</strong></p>
<p>Some features of <strong>C++ 11</strong> is used.</p>
<p>For better efficiency, remember to add optimizer <strong>-O2</strong> when compiling.</p>
<p>Run on a <strong>x64</strong> PC and using x64 compiler, or the memory might not enough.</p>
<p>If using any IDE, use Release mode to run.</p>
<h3><span id="how-to-run">How to run</span></h3><p>Set up the file folders for output and source data, fill-in the config.cpp as your directory, compile and run on Visual Studio.</p>
<h2><span id="code-structure-amp-utility">Code Structure &amp; Utility</span></h2><p><strong>&lt;config.h&gt; / &lt;config.cpp&gt;</strong>: </p>
<blockquote>
<p>Configure file for user to change their data set directory, output directories, and total number data file user want to process with this program.</p>
</blockquote>
<p><strong>&lt;file_util.h&gt;/&lt;file_util.cpp&gt;</strong>: </p>
<blockquote>
<p>Provided different functions to: </p>
<ul>
<li>Load file from disk directly to memory</li>
<li>Save hashmap/map from memory to disk with different method (ascii)</li>
<li>Save vector from memory to disk in binary mode</li>
<li>Get the filenames recursively in a dictionary</li>
</ul>
</blockquote>
<p><strong>&lt;merge.h&gt;/&lt;merge.cpp&gt;</strong>:</p>
<blockquote>
<p>Implement an I/O efficient merge sort algorithm for sorted files.</p>
<p>Used to merge the intermediate file and generate final inverted index</p>
</blockquote>
<p><strong>&lt;inverted_index.cpp&gt;</strong>:</p>
<blockquote>
<p>Main function in this file.</p>
<p>Used to parse, sort the in-file data and generate intermediate postings</p>
</blockquote>
<h2><span id="logic-of-the-program">Logic of the program</span></h2><h3><span id="part-i-parsing-sorting-and-intermediate-posting-generating">Part I - Parsing, Sorting and Intermediate Posting Generating</span></h3><p><strong>Load file</strong></p>
<p>In this part a file about 400 MB is loaded into the memory. Several methods are tested and the direct call for C function <strong>fread</strong> is the fastest. (Because the ifstream’s buffer is only 512 Bytes, which is very inefficient when load a big file at a time.)</p>
<p>Because this program is intended to handle all languages.(Some language characters are encoded within wide char <strong>wchar_t</strong>) So the File loaded to memory would be then converted to <strong>wstring</strong> format with <strong>utf-8</strong> encoding.</p>
<p><strong>Parse</strong></p>
<p>For each document loaded to the memory, the program would scan the whole document. During this loop, different documents would be parsed out according to the structure of .WET file. Moreover, the program will parse out the term in the document and insert them into a structure for further use. </p>
<p>The way a term is defined in this program is a continuous string without any character that is not a number or English character. And the term’s length is less than 30 words. (In the parsed data, only a little bit of terms are beyond 15 characters)</p>
<p><strong>Sort</strong></p>
<p>For the I/O efficient merge sort later, the data in each posting is sorted by lexicographical order.</p>
<p>During the parse phase, the term is inserted into a map along with the accordingly document ID and term frequency.  So the data is sorted. We just need to output the map iteratively, the intermediate posting is sorted.</p>
<p>Insert to a Map might slower than a hash Map, because a <strong>O(lgn)</strong> reform of the RB tree is requires for every insert. But say we have total <strong>k</strong> intermediate postings, each have <strong>n</strong> terms. The complexity of each possible implementation is listed:</p>
<blockquote>
<p>Use map to generate sorted postings and then one-pass merge: <strong>k*(n+nlg(n)) + nlg(k)</strong></p>
</blockquote>
<blockquote>
<p>Use hash map to generate postings, unix sort and then one-pass merge: <strong>k*n +k*nlg(n) + nlg(k)</strong> </p>
</blockquote>
<p>So basically the complexity is same.</p>
<p><strong>Posting Generating</strong></p>
<p>Because the data is too big too load in to memory, so as long as there are more than 2,000,000 terms in memory, the program would output it as an intermediate posting. Which is typically 180 Mb each. The intermediate postings are named in same format for further use.</p>
<p><strong>Url -&gt; document Map</strong></p>
<p>During the main loop, when encountering a new document(web page), the program would add a key-value pair to hash map. After all the documents in the data set is processed, the Url - Document map would be save to disk.</p>
<p>Because the data set I used to test is relatively small (48 GB). So if this inverted index is going to be used distributed or dealing with large size of data, the Url - Document map need to be save to the disk periodically.</p>
<p>The document ID is a global increasing integer, which is assigned to each documents by the order documents are parsed.</p>
<h3><span id="part-ii-io-efficient-merge-and-lexicon-generating">Part II  - I/O Efficient Merge and  Lexicon Generating</span></h3><p><strong>Merge Sort</strong></p>
<p>An I/O efficient merge sort algorithm is implemented for the merge sort.  For every intermediated  postings,  a stream is created to load data from. A <strong>Priority Queue</strong> (in C++ STL, priority_queue is implemented by a heap) is used to compare the current input from different intermediate postings. </p>
<p>At first each postings would read one term and insert it into the priority queue. Then for each loop, the top of the priority queue is popped and the term’s document ID and frequency is loaded into a 2-D vector. And the corresponding stream would read a term from the intermediate posting, insert it priority Queue.</p>
<p><strong>Inverted Index Output</strong></p>
<p>When the 2-D vector has grown to a specific size, we need to output it from memory to the disk. Hence we don’t want a term to be split into two files. Because in the lexicon map, each term is pointing to a specific inverted_index file. So the program would wait until the newly loaded term into priority queue is a new term, and then save the 2-D vector to the disk.</p>
<p>Because in C++, the data of vector is saved continuously in memory, we can save the data to memory with one <strong>fwrite</strong> in binary mode. Which is easier for us to use this index to query a term in the query processor.</p>
<p><strong>Data Compression</strong>(To Do)</p>
<p>Variable Char can be used to achieve the data compression for inverted index.</p>
<p>Don’t need to save the docId, difference between docId instead.</p>
<p><strong>Lexicon Map</strong></p>
<p>During the processing of the intermediate postings, the lexicon Map would be built up as a hash map.  When ever there’s 100,000,000 entries in the hash map, the program would output a file to store the information of lexicon. </p>
<h2><span id="efficiency-test">Efficiency test</span></h2><p>To test the efficiency, I used <strong>120</strong> WET files as input, the size of data is  about <strong>48</strong> GB. With a total of <strong>5350784</strong> pages and <strong>230020664</strong> terms as defined above.</p>
<p>The first step of parse and sort took <strong>235</strong> minutes.</p>
<p>The second step of merge took <strong>300</strong> minutes.</p>
<p>The inverted index generated is <strong>13.4</strong> GB. Lexicon map generated is <strong>1.2</strong> GB.</p>
<p>The speed of merge is slower than it suppose to be, and I think it is because of the using of file stream to read the intermediate file. There are two possible solutions to speed up. One is to manually set a comparatively larger buffer for the file stream in c++ STL. Another one is to directly map the memory to disk using memory map method.</p>
<h2><span id="todo">ToDo</span></h2><ol>
<li>Using data compression skills to compress the inverted index in the merge phase.</li>
<li>Modify the merge phase code to make I/O faster (larger buffer / memory map), to speed up the merge phase.</li>
<li>Maybe add some parameters to make the program more flexible, less hard code. </li>
</ol>
<p>Latest version at: <a href="https://github.com/saltonz/Inverted-Index" target="_blank" rel="noopener">https://github.com/saltonz/Inverted-Index</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saltonz.github.io/2019/09/28/Search Engine/Multi_Thread_Crawler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Salton Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Salton's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/28/Search Engine/Multi_Thread_Crawler/" itemprop="url">Multi thread python crawler</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-28T00:00:00-04:00">
                2019-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Information-Retrivement/" itemprop="url" rel="index">
                    <span itemprop="name">Information Retrivement</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="Multi-thread-crawler"><a href="#Multi-thread-crawler" class="headerlink" title="Multi thread crawler"></a>Multi thread crawler</h2><h3 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h3><ul>
<li><strong>Priority</strong>: related to the uncrawled graph - which one has more hyperline point to or have more score on PageRank</li>
<li><strong>Novelty</strong>: Whether the site of a page has been crawled before.</li>
<li><strong>Output</strong>: A log with a list of all visited <strong>URLs</strong> in the order they are visited, together with the information such as <strong>size of the page</strong> and <strong>depth</strong> of each page, <strong>priority score</strong> of the page when it was crawled and the <strong>timestamp</strong> of the download.</li>
</ul>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python run.py <span class="string">"[Your Query]"</span> [max_number of pages you want to crawl]</span><br><span class="line"></span><br><span class="line">More than two parameters is invalid.</span><br><span class="line"></span><br><span class="line">e.g: python run.py <span class="string">"Brooklyn parks"</span> 1000</span><br></pre></td></tr></table></figure>
<h3 id="Env"><a href="#Env" class="headerlink" title="Env"></a>Env</h3><p>Python 3.7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">requests==2.8.0</span><br><span class="line">BeautifulSoup4==4.8.0</span><br><span class="line">lxml==4.4.1</span><br><span class="line">pybloom_live==3.0.0</span><br><span class="line">pymongo==3.9.0</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/09/28/Search Engine/Multi_Thread_Crawler/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saltonz.github.io/2019/03/27/basic/smart_ptr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Salton Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Salton's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/27/basic/smart_ptr/" itemprop="url">Smart_ptr</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-27T00:00:00-04:00">
                2019-03-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/basic/" itemprop="url" rel="index">
                    <span itemprop="name">basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="智能指针"><a href="#智能指针" class="headerlink" title="智能指针"></a>智能指针</h2><p>在c++中，经常使用new,delete在堆上动态分配内存</p>
<ul>
<li>new: 为对象分配一个空间并返回指向该空间的指针</li>
<li>delete: 指向一个动态独享的指针，销毁对象，并释放与之关联的内存</li>
</ul>
<p>动态分配内存常出现问题</p>
<ul>
<li>一、忘记释放内存/内存在运行到delete前中止， 造成内存泄漏</li>
<li>二、在内存仍然有指针引用的情况下释放，产生引用非法内存的指针</li>
</ul>
<p>C++11中引入了智能指针：share_ptr允许多个指针指向一个对象，unique_ptr则独占所指向的对象。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/03/27/basic/smart_ptr/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saltonz.github.io/2019/03/27/basic/lock_between_threads/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Salton Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Salton's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/27/basic/lock_between_threads/" itemprop="url">Thread Locks in Cpp</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-27T00:00:00-04:00">
                2019-03-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/basic/" itemprop="url" rel="index">
                    <span itemprop="name">basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="C-线程锁"><a href="#C-线程锁" class="headerlink" title="C++ 线程锁"></a>C++ 线程锁</h2><h4 id="1-互斥锁（Mutex）"><a href="#1-互斥锁（Mutex）" class="headerlink" title="1. 互斥锁（Mutex）"></a>1. 互斥锁（Mutex）</h4><p>互斥锁是一个控制多个线程对他们共享资源访问的信号量。 如：线程池中有多个空闲线程和一个任务队列，所有线程都应该使用互斥锁互斥访问该任务队列，避免多个线程同时访问任务队列发生错乱。</p>
<p>在某一时刻，只有一个线程能够访问互斥锁，在互斥锁释放之前所有其他线程都不能获取该互斥锁</p>
<blockquote>
<p>头文件:\<mutex><br>类型:std::mutex</mutex></p>
</blockquote>
<p>例子：<br>调用lock/unlock函数加锁<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread/mutex.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread/thread.hpp&gt;</span></span></span><br><span class="line"> </span><br><span class="line">boost::mutex mutex;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Counter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mutex.lock();</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int</span> i = ++count;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"count == "</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  mutex.unlock();  <span class="comment">// 如果前面的代码有异常，就调用不到unlock。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  boost::thread_group threads;  <span class="comment">// 创建一组线程。</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    threads.create_thread(&amp;Counter);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  threads.join_all();  <span class="comment">// 等待所有线程结束。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/03/27/basic/lock_between_threads/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saltonz.github.io/2019/03/26/basic/Thread_Process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Salton Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Salton's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/26/basic/Thread_Process/" itemprop="url">Thread & Process</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-26T00:00:00-04:00">
                2019-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/basic/" itemprop="url" rel="index">
                    <span itemprop="name">basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Thread-amp-Process"><a href="#Thread-amp-Process" class="headerlink" title="Thread &amp; Process"></a>Thread &amp; Process</h1><h2 id="进程："><a href="#进程：" class="headerlink" title="进程："></a>进程：</h2><ul>
<li>从程序角度：<br>计算机中正在运行在内存中的程序  {代码 + 数据 + 堆栈 + PCB(进程控制块)}</li>
<li>从操作系统角度：<br>进程是一个术语，在UNIX、Linux和其他一些操作系统中，当程序启动时（由用户输入shell命令或由另一程序启动），进程开始。每个进程的描述都是一个结构体的统称及进程控制块（PCB）linux下叫具体为task_struct。</li>
</ul>
<h4 id="进程的状态："><a href="#进程的状态：" class="headerlink" title="进程的状态："></a>进程的状态：</h4><blockquote>
<p>running （R）运行状态，该状态不只是指程序正在运行，还包括准备运行的状态。<br>sleeping （S）可中断睡眠状态 ，<br>disk sleeping（D）不可中断睡眠状态，系统的休眠等待，不可用户打断，有特殊方式唤醒<br>stopped（T）停止状态，通过发送sigstop信号停止，可以通过发送sigcont信号继续。<br>tracing stop（t）跟踪状态<br>dead（X）死亡状态，是一个返回状态，时间很短，<br>zombie（Z）僵尸状态，子进程先于父进程退出，而且父进程不关心子进程的退出状态，从而形成。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/03/26/basic/Thread_Process/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Salton Zhao</p>
              <p class="site-description motion-element" itemprop="description">My Blog to document some of my notes</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Salton Zhao</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
